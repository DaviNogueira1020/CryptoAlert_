generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String?
  alerts    Alert[]
  notifications Notification[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Alert {
  id              String         @id @default(uuid())
  userId          Int
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  crypto          String
  baseCurrency    String?        // USD, BRL, USDT, etc.
  targetPrice     Float
  direction       AlertDirection

  isActive        Boolean        @default(true)
  isFavorite      Boolean        @default(false)
  notifyOnce      Boolean        @default(false)

  initialPrice    Float?
  lastTriggeredAt DateTime?

  title           String?        // Nome curto do alerta
  notes           String?        // Texto opcional do usuário

  cooldown        Int?           // em segundos (60, 300, 3600...)
  cooldownMinutes Int?           // minutos de cooldown (nova coluna)

  createdAt       DateTime       @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([crypto])
}

model Notification {
  id        String   @id @default(uuid())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  crypto    String
  target    Float
  direction AlertDirection

  title     String?
  message   String?
  type      NotificationType @default(alert)
  read      Boolean  @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([crypto])
}

enum NotificationType {
  system
  alert
  security
  info
}

enum AlertDirection {
  above
  below
}
